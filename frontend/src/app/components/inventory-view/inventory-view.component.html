<div class="w-full">
  <!-- Legend -->
  <div class="flex justify-center space-x-6 mb-4">
    <div class="flex items-center"><span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span> Disponible</div>
    <div class="flex items-center"><span class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></span> Reservada</div>
    <div class="flex items-center"><span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span> Vendida</div>
  </div>

  <!-- Building View with Horizontal Scroll -->
  <div class="overflow-x-auto pb-4">
    <div class="inline-block min-w-full">
      <div class="flex flex-col space-y-2">
        @for (floor of floors; track floor) {
          <div class="flex items-center">
            <div class="w-12 font-bold text-gray-700 text-right pr-2 text-xs flex-shrink-0">P{{
            floor.floorNumber }}</div>
            <div class="flex space-x-1.5">
              @for (unit of floor.units; track unit) {
                <div
                  class="group relative flex-shrink-0 w-20 p-1.5 rounded shadow-md text-white cursor-pointer hover:shadow-lg transition-all duration-200"
                  [ngClass]="getStatusColor(unit.estado)">
                  <div class="font-bold text-xs">{{ unit.nombre }}</div>
                  <div class="text-[10px] opacity-90">{{ unit.tipologia }}</div>
                  <div class="text-[10px] opacity-90">{{ unit.metrosCuadrados }} m²</div>
                  <div class="mt-0.5 font-semibold text-[10px]">{{ unit.valorUf | number:'1.0-0' }} UF</div>
                  <!-- Tooltip -->
                  <div
                    class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 bg-gray-900 text-white text-xs rounded-lg p-3 shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-10 pointer-events-none">
                    <div class="font-bold text-sm mb-2 border-b border-gray-700 pb-2">{{ unit.nombre }} - {{
                    unit.tipologia }}</div>
                    <div class="space-y-1">
                      <div class="flex justify-between">
                        <span class="text-gray-400">Estado:</span>
                        <span class="font-semibold">{{ unit.estado }}</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-400">Superficie:</span>
                        <span>{{ unit.metrosCuadrados }} m²</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-400">Precio:</span>
                        <span class="font-bold text-green-400">{{ unit.valorUf | number:'1.0-0' }}
                        UF</span>
                      </div>
                      <div class="flex justify-between">
                        <span class="text-gray-400">Piso:</span>
                        <span>{{ unit.piso }}</span>
                      </div>
                      <!-- Conditional info based on status -->
                      @if (unit.estado === 'Vendida') {
                        <div class="mt-2 pt-2 border-t border-gray-700">
                          <div class="flex justify-between">
                            <span class="text-gray-400">Escrituración:</span>
                            <span class="text-yellow-400">Pendiente</span>
                          </div>
                        </div>
                      }
                      @if (unit.estado === 'Disponible') {
                        <div
                          class="mt-2 pt-2 border-t border-gray-700 text-green-300">
                          <div class="text-xs">✓ Disponible para reserva inmediata</div>
                          <div class="text-xs">✓ Excelente orientación</div>
                          <div class="text-xs">✓ Financiamiento disponible</div>
                        </div>
                      }
                      @if (unit.estado === 'Reservada') {
                        <div class="mt-2 pt-2 border-t border-gray-700">
                          <div class="flex justify-between">
                            <span class="text-gray-400">Reserva expira:</span>
                            <span class="text-yellow-400">{{ unit.reservaExpiraEn ?
                            (unit.reservaExpiraEn | date:'short') : 'N/A' }}</span>
                          </div>
                        </div>
                      }
                    </div>
                    <!-- Arrow -->
                    <div class="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                      <div
                        class="w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900">
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</div>